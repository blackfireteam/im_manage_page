(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["appManage"],{"534d":function(e,t,n){"use strict";n.r(t);n("d3b7"),n("b0c0"),n("e9c4"),n("7db0");var c=n("7a23"),o=n("5530"),a=n("866a"),r=n("a87f"),i=n("99cb"),l=n("44a6"),u={class:"dialog-footer"},d=Object(c["createTextVNode"])("取 消"),p=Object(c["createTextVNode"])("确 定"),f=Object(c["defineComponent"])({emits:["submit"],setup:function(e,t){var n=t.expose,f=t.emit,b=Object(c["getCurrentInstance"])().appContext.config.globalProperties,s=Object(c["reactive"])({email:""});n({open:m});var O=Object(c["ref"])(!1),j=Object(c["ref"])();function m(e){j.value=e,O.value=!0}var g=Object(c["ref"])();function v(){O.value=!1,g.value.clearValidate(),s.email=""}function h(){var e={appId:j.value,email:s.email},t=b.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(i["AppAssign"],r["d"].AppAssign,e).then((function(t){var n=JSON.parse(t.msg);f("submit",Object(o["a"])(Object(o["a"])({},e),{},{id:n.id})),Object(l["d"])(b.$message,"设置App管理员成功","success"),O.value=!1})).catch((function(e){Object(l["d"])(b.$message,"设置失败：".concat(e.msg||""))})).finally((function(){t.close()}))}return function(e,t){var n=Object(c["resolveComponent"])("el-input"),o=Object(c["resolveComponent"])("el-form-item"),a=Object(c["resolveComponent"])("el-form"),r=Object(c["resolveComponent"])("el-button"),i=Object(c["resolveComponent"])("el-dialog");return Object(c["openBlock"])(),Object(c["createBlock"])(i,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return O.value=e}),width:"500px",title:"设置App管理员",onClose:v},{footer:Object(c["withCtx"])((function(){return[Object(c["createElementVNode"])("span",u,[Object(c["createVNode"])(r,{onClick:v},{default:Object(c["withCtx"])((function(){return[d]})),_:1}),Object(c["createVNode"])(r,{type:"primary",onClick:h},{default:Object(c["withCtx"])((function(){return[p]})),_:1})])]})),default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(a,{model:Object(c["unref"])(s),ref_key:"fromRef",ref:g,labelWidth:"60px"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(o,{label:"email："},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(n,{modelValue:Object(c["unref"])(s).email,"onUpdate:modelValue":t[0]||(t[0]=function(e){return Object(c["unref"])(s).email=e}),autocomplete:"off",clearable:""},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["modelValue"])}}});const b=f;var s=b,O=n("6c02"),j=n("0613"),m=function(e){return Object(c["pushScopeId"])("data-v-398d99af"),e=e(),Object(c["popScopeId"])(),e},g={class:"app_manage"},v={class:"title_wrapper"},h={class:"title"},C=m((function(){return Object(c["createElementVNode"])("span",{class:"title_text"},"App管理",-1)})),k={class:"main_wrapper"},N=Object(c["createTextVNode"])(" 管理 "),V=Object(c["createTextVNode"])(" 取消App管理员 "),x=Object(c["createTextVNode"])(" 设置App管理员 "),w=Object(c["defineComponent"])({setup:function(e){var t=Object(c["getCurrentInstance"])().appContext.config.globalProperties,n=Object(O["d"])(),o=Object(c["computed"])((function(){return j["a"].state.userInfo})),u=Object(c["ref"])([]);function d(){var e=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(i["AppList"],r["d"].AppList).then((function(e){u.value=JSON.parse(e.msg)})).catch((function(e){})).finally((function(){e.close()}))}function p(e){var u=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(i["AppCheckout"],r["d"].AppCheckout,{appId:e.id}).then((function(a){Object(l["d"])(t.$message,"checkOut App 成功","success");var r={appId:e.id,appTitle:e.name,managerEmail:e.email};j["a"].commit("setAppInfo",r),window.sessionStorage.setItem("appInfo",JSON.stringify(r)),o.value.isStaff?f(u):(u.close(),Object(c["nextTick"])((function(){n.push({name:"appState"})})))})).catch((function(e){u.close(),Object(l["d"])(t.$message,"checkOut App 失败：".concat(e.msg||""))}))}function f(e){Object(a["d"])(i["StaffInfo"],r["d"].StaffInfo).then((function(e){j["a"].commit("setStaffInfo",JSON.parse(e.msg)),Object(c["nextTick"])((function(){n.push({name:"appState"})}))})).catch((function(e){Object(l["d"])(t.$message,"获取Staff权限信息失败：".concat(e.msg||""))})).finally((function(){e.close()}))}Object(c["onMounted"])((function(){d()}));var b=Object(c["ref"])();function m(e){b.value.open(e)}function w(e){var t=u.value.find((function(t){return t.id===e.appId}));t&&(t.email=e.email,t.uid=e.id)}function _(e){var n={appId:e.id,del:!0},c=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(i["AppAssign"],r["d"].AppAssign,n).then((function(n){e.uid=void 0,e.email="",Object(l["d"])(t.$message,"操作成功","success")})).catch((function(e){Object(l["d"])(t.$message,"取消管理员失败：".concat(e.msg||""))})).finally((function(){c.close()}))}return function(e,t){var n=Object(c["resolveComponent"])("el-button"),a=Object(c["resolveComponent"])("el-tooltip"),r=Object(c["resolveComponent"])("el-table-column"),i=Object(c["resolveComponent"])("el-table");return Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],null,[Object(c["createElementVNode"])("div",g,[Object(c["createElementVNode"])("div",v,[Object(c["createElementVNode"])("div",h,[C,Object(c["createVNode"])(a,{effect:"dark",content:"刷新",placement:"bottom"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(n,{type:"text",icon:"el-icon-refresh",onClick:t[0]||(t[0]=function(e){return d()}),circle:""})]})),_:1})])]),Object(c["createElementVNode"])("div",k,[Object(c["createVNode"])(i,{data:u.value,size:"large",border:"",maxHeight:"650px"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(r,{prop:"id",label:"AppID",minWidth:"80"}),Object(c["createVNode"])(r,{prop:"name",label:"AppName",minWidth:"150"}),Object(c["unref"])(o).isStaff?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(r,{key:0,prop:"uid",label:"管理员id",minWidth:"160"},{default:Object(c["withCtx"])((function(e){return[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.row.uid?e.row.uid:""),1)]})),_:1})),Object(c["unref"])(o).isStaff?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(r,{key:1,prop:"email",label:"管理员邮箱",minWidth:"170"})),Object(c["createVNode"])(r,{prop:"total_reg_count",label:"总用户数",minWidth:"80"}),Object(c["createVNode"])(r,{prop:"total_msg_count",label:"总消息数",minWidth:"80"}),Object(c["createVNode"])(r,{label:"操作",minWidth:"220"},{default:Object(c["withCtx"])((function(e){return[Object(c["createVNode"])(n,{type:"primary",size:"small",onClick:function(t){return p(e.row)}},{default:Object(c["withCtx"])((function(){return[N]})),_:2},1032,["onClick"]),Object(c["unref"])(o).userManage&&e.row.email?(Object(c["openBlock"])(),Object(c["createBlock"])(n,{key:0,type:"danger",size:"small",onClick:function(t){return _(e.row)}},{default:Object(c["withCtx"])((function(){return[V]})),_:2},1032,["onClick"])):Object(c["unref"])(o).userManage?(Object(c["openBlock"])(),Object(c["createBlock"])(n,{key:1,type:"primary",size:"small",onClick:function(t){return m(e.row.id)}},{default:Object(c["withCtx"])((function(){return[x]})),_:2},1032,["onClick"])):Object(c["createCommentVNode"])("",!0)]})),_:1})]})),_:1},8,["data"])])]),Object(c["createVNode"])(s,{ref_key:"appAdminDialog",ref:b,onSubmit:w},null,512)],64)}}}),_=(n("a474"),n("6b0d")),A=n.n(_);const y=A()(w,[["__scopeId","data-v-398d99af"]]);t["default"]=y},"6b0d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=e.__vccOpts||e;for(const[c,o]of t)n[c]=o;return n}},a474:function(e,t,n){"use strict";n("a512")},a512:function(e,t,n){},e9c4:function(e,t,n){var c=n("23e7"),o=n("da84"),a=n("d066"),r=n("2ba4"),i=n("e330"),l=n("d039"),u=o.Array,d=a("JSON","stringify"),p=i(/./.exec),f=i("".charAt),b=i("".charCodeAt),s=i("".replace),O=i(1..toString),j=/[\uD800-\uDFFF]/g,m=/^[\uD800-\uDBFF]$/,g=/^[\uDC00-\uDFFF]$/,v=function(e,t,n){var c=f(n,t-1),o=f(n,t+1);return p(m,e)&&!p(g,o)||p(g,e)&&!p(m,c)?"\\u"+O(b(e,0),16):e},h=l((function(){return'"\\udf06\\ud834"'!==d("\udf06\ud834")||'"\\udead"'!==d("\udead")}));d&&c({target:"JSON",stat:!0,forced:h},{stringify:function(e,t,n){for(var c=0,o=arguments.length,a=u(o);c<o;c++)a[c]=arguments[c];var i=r(d,null,a);return"string"==typeof i?s(i,j,v):i}})}}]);